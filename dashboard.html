<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REPTECH - Painel</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --bg-color: #000000; --card-bg: #111111; --accent-blue: #007AFF; --text-primary: #ffffff; --border-color: #2C2C2E; --danger-color: #FF453A; }
        body { background-color: var(--bg-color); color: var(--text-primary); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; padding-bottom: 50px; }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .user-info h2 { margin: 0; font-size: 24px; font-weight: 800; letter-spacing: 0.5px; }
        .user-info p { color: #888; margin: 5px 0 0 0; font-size: 14px; }
        
        .btn-profile-small { background: #222; color: white; border: 1px solid #333; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; text-decoration: none; display: inline-block; margin-left: 10px;}
        
        /* BOTÃ•ES PRINCIPAIS */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px; }
        .card-action {
            background: #1c1c1e; border: 1px solid #333; border-radius: 15px; padding: 20px;
            text-align: center; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 120px;
        }
        .card-action:active { transform: scale(0.98); background: #2c2c2e; }
        .card-action h3 { margin: 10px 0 5px 0; color: var(--accent-blue); font-size: 16px; }
        .big-icon { font-size: 32px; display: block; margin-bottom: 5px; }
        .card-action p { font-size: 11px; color: #666; margin: 0; }

        /* SEÃ‡ÃƒO DE FICHAS */
        .section-title { font-size: 18px; font-weight: 700; margin-bottom: 15px; border-left: 4px solid var(--accent-blue); padding-left: 10px; }
        
        .routine-card { 
            background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; 
            padding: 15px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; 
        }
        .routine-info h4 { margin: 0 0 5px 0; font-size: 16px; color: white; }
        .routine-info span { font-size: 12px; color: #666; }
        
        .routine-actions { display: flex; gap: 10px; }
        .btn-play { background: var(--accent-blue); color: white; border: none; width: 40px; height: 40px; border-radius: 50%; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .btn-delete { background: #222; color: var(--danger-color); border: 1px solid #333; width: 40px; height: 40px; border-radius: 50%; font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .empty-msg { color: #555; font-size: 14px; text-align: center; padding: 20px; border: 1px dashed #333; border-radius: 10px; }

        .btn-logout { background: transparent; border: none; color: #555; font-size: 12px; cursor: pointer; text-decoration: underline;}
    </style>
</head>
<body>

    <div class="header">
        <div class="user-info">
            <h2 id="user-name">OlÃ¡, ...</h2> <p id="user-stats">Carregando...</p>
        </div>
        <div><a href="perfil.html" class="btn-profile-small">Perfil</a></div>
    </div>

    <div class="action-grid">
        <div class="card-action" onclick="goToWorkout()">
            <span class="big-icon">âš¡</span>
            <h3>Treino Livre</h3>
            <p>ComeÃ§ar do zero</p>
        </div>
        <div class="card-action" onclick="window.location.href='historico.html'">
            <span class="big-icon">ðŸ“…</span>
            <h3>HistÃ³rico</h3>
            <p>Ver evoluÃ§Ã£o</p>
        </div>
    </div>

    <div class="section-title">Minhas Fichas</div>
    <div id="routines-list">
        <div class="empty-msg">Carregando fichas...</div>
    </div>

    <div style="text-align:center; margin-top:40px;">
        <button class="btn-logout" onclick="logout()">Sair da conta</button>
    </div>

    <script>
        // --- API KEY JÃ CONFIGURADA ---
        const firebaseConfig = {
            apiKey: "AIzaSyDo2Vhtj4aldfEr6CHoXVWP4fhhC1GZZIo",
            authDomain: "reptech-mvp.firebaseapp.com",
            databaseURL: "https://reptech-mvp-default-rtdb.firebaseio.com",
            projectId: "reptech-mvp",
            storageBucket: "reptech-mvp.firebasestorage.app",
            messagingSenderId: "350784354776",
            appId: "1:350784354776:web:6d7c99682b8e0980ec1aad",
            measurementId: "G-9Q9J9WRBMZ"
        };
        
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        auth.onAuthStateChanged(user => {
            if (user) {
                loadUserData(user.uid);
                loadRoutines(user.uid);
            } else {
                window.location.href = "index.html";
            }
        });

        function loadUserData(uid) {
            db.ref('usuarios/' + uid + '/perfil').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.nome) {
                    document.getElementById('user-name').innerText = `OlÃ¡, ${data.nome.split(' ')[0]}`;
                    let stats = "";
                    if(data.peso) stats += `${data.peso}kg `;
                    if(data.altura) stats += `â€¢ ${data.altura}cm`;
                    document.getElementById('user-stats').innerText = stats || "Bora treinar?";
                } else {
                    document.getElementById('user-name').innerText = "OlÃ¡, Atleta";
                    document.getElementById('user-stats').innerText = "Complete seu perfil âž”";
                }
            });
        }

        // --- FUNÃ‡ÃƒO PARA CARREGAR FICHAS ---
        function loadRoutines(uid) {
            const listDiv = document.getElementById('routines-list');
            
            db.ref('usuarios/' + uid + '/rotinas').on('value', (snapshot) => {
                listDiv.innerHTML = ""; // Limpa lista
                const data = snapshot.val();

                if (!data) {
                    listDiv.innerHTML = '<div class="empty-msg">VocÃª ainda nÃ£o criou nenhuma ficha.<br>Inicie um treino livre e clique em Salvar ðŸ’¾.</div>';
                    return;
                }

                // Loop pelas fichas
                Object.entries(data).forEach(([id, routine]) => {
                    const exerciseCount = routine.exercicios ? routine.exercicios.length : 0;
                    
                    const html = `
                    <div class="routine-card">
                        <div class="routine-info">
                            <h4>${routine.nome}</h4>
                            <span>${exerciseCount} exercÃ­cios</span>
                        </div>
                        <div class="routine-actions">
                            <button class="btn-delete" onclick="deleteRoutine('${id}')">ðŸ—‘</button>
                            <button class="btn-play" onclick="startRoutine('${id}')">â–¶</button>
                        </div>
                    </div>`;
                    
                    listDiv.insertAdjacentHTML('beforeend', html);
                });
            });
        }

        function deleteRoutine(id) {
            if(confirm("Tem certeza que deseja excluir esta ficha?")) {
                const uid = auth.currentUser.uid;
                db.ref(`usuarios/${uid}/rotinas/${id}`).remove();
            }
        }

        function startRoutine(id) {
            // Redireciona para o treino passando o ID da ficha na URL
            window.location.href = `treino.html?rotina=${id}`;
        }

        function logout() {
            auth.signOut().then(() => { window.location.href = "index.html"; });
        }

        function goToWorkout() { window.location.href = "treino.html"; }
    </script>
</body>
</html>